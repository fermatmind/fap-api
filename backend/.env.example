# =========================================================
# PRODUCTION REQUIRED (must be set by Ops before deploy)
# - DB: DB_CONNECTION, DB_HOST, DB_PORT, DB_DATABASE, DB_USERNAME, DB_PASSWORD
# - Webhook Secret: STRIPE_WEBHOOK_SECRET, BILLING_WEBHOOK_SECRET, INTEGRATIONS_WEBHOOK_*_SECRET
# - Admin/Auth: FAP_ADMIN_TOKEN, EVENT_INGEST_TOKEN
# - S3: AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY, AWS_BUCKET
# - Mail: MAIL_MAILER, MAIL_HOST, MAIL_PORT, MAIL_USERNAME, MAIL_PASSWORD, MAIL_FROM_ADDRESS
# Do NOT commit real secrets in this file.
# =========================================================

APP_NAME=Laravel
APP_ENV=local
APP_KEY=base64:CHANGEME
APP_DEBUG=false
APP_VERSION=unknown
APP_URL=http://localhost
# Sitemap <loc> URL prefix for public tests pages.
SEO_TESTS_URL_PREFIX=http://localhost/tests/
HEALTHZ_ALLOWED_IPS=127.0.0.1/32,10.0.0.0/8,192.168.0.0/16
HEALTHZ_VERBOSE=false

APP_LOCALE=en
APP_FALLBACK_LOCALE=en
APP_FAKER_LOCALE=en_US

APP_MAINTENANCE_DRIVER=file
# APP_MAINTENANCE_STORE=database

# PHP_CLI_SERVER_WORKERS=4

BCRYPT_ROUNDS=12

LOG_CHANNEL=stack
LOG_STACK=single
LOG_DEPRECATIONS_CHANNEL=null
LOG_LEVEL=info

# =========================
# DB (CI-safe default)
# =========================
DB_CONNECTION=sqlite
DB_DATABASE=/tmp/fap-ci.sqlite
# DB_HOST=127.0.0.1
# DB_PORT=3306
# DB_DATABASE=laravel
# DB_USERNAME=root
# DB_PASSWORD=

# =========================
# Runtime defaults (CI-safe)
# =========================
SESSION_DRIVER=file
SESSION_LIFETIME=120
SESSION_ENCRYPT=false
SESSION_PATH=/
SESSION_DOMAIN=null

BROADCAST_CONNECTION=log
FILESYSTEM_DISK=local

# CI / local dev: avoid database-backed queues/cache unless migrations run
QUEUE_CONNECTION=sync
CACHE_STORE=file
# CACHE_PREFIX=

MEMCACHED_HOST=127.0.0.1

REDIS_CLIENT=phpredis
REDIS_HOST=127.0.0.1
REDIS_PASSWORD=null
REDIS_PORT=6379

MAIL_MAILER=log
MAIL_SCHEME=null
MAIL_HOST=127.0.0.1
MAIL_PORT=2525
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_FROM_ADDRESS="hello@example.com"
MAIL_FROM_NAME="${APP_NAME}"

AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_DEFAULT_REGION=us-east-1
AWS_BUCKET=
AWS_USE_PATH_STYLE_ENDPOINT=false

VITE_APP_NAME="${APP_NAME}"

# =========================
# Fermat Assessment Platform (FAP)
# =========================

# 本地推荐：driver=local + 指向仓库的 content_packages 根目录
# backend/.env.example 位于 backend/，因此 ../content_packages 指向仓库根目录的 content_packages
FAP_PACKS_DRIVER=local
FAP_PACKS_ROOT=../content_packages
FAP_PACKS_CACHE_DIR=storage/app/private/content_packs_cache
FAP_PACKS_CACHE_TTL_SECONDS=3600
CONTENT_LOADER_CACHE_STORE=array
CONTENT_LOADER_CACHE_TTL_SECONDS=300

# 线上建议：driver=s3（本地也可用，但需要你把 S3/COS 的包同步到 cache_dir/<dir_version>/）
FAP_S3_DISK=s3
FAP_S3_PREFIX=content_packages/

# 默认包（避免 resolver 选错包/选到 default）
FAP_DEFAULT_PACK_ID=MBTI.cn-mainland.zh-CN.v0.2.1-TEST
FAP_DEFAULT_DIR_VERSION=MBTI-CN-v0.2.1-TEST
FAP_DEFAULT_REGION=CN_MAINLAND
FAP_DEFAULT_LOCALE=zh-CN

# Global/CN legal URLs used by /api/v0.4/boot and email templates.
FAP_GLOBAL_TERMS_URL=http://localhost/terms
FAP_GLOBAL_PRIVACY_URL=http://localhost/privacy
FAP_GLOBAL_REFUND_URL=http://localhost/refund
FAP_CN_TERMS_URL=http://localhost/zh/terms
FAP_CN_PRIVACY_URL=http://localhost/zh/privacy
FAP_CN_REFUND_URL=http://localhost/zh/refund
# Optional regional overrides (fallback to global URLs when empty).
FAP_US_TERMS_URL=
FAP_US_PRIVACY_URL=
FAP_US_REFUND_URL=
FAP_EU_TERMS_URL=
FAP_EU_PRIVACY_URL=
FAP_EU_REFUND_URL=
FAP_SUPPORT_EMAIL=support@fermatmind.com

# 报告/内容版本（业务层使用）
FAP_CONTENT_PACKAGE_VERSION=v0.2.1-TEST
FAP_PROFILE_VERSION=mbti32-v2.5
FAP_LEGACY_ORG_ID=1

# 行为开关
FAP_STORE_ANSWERS_TO_STORAGE=false
FAP_READS_DEBUG=false
FEATURE_ENABLE_V0_2_REPORT=false
FEATURE_SELFCHECK_V2=false
FEATURE_LEGACY_MBTI_REPORT_PAYLOAD_V2=false
FEATURE_PAYMENT_WEBHOOK_V2=false
FEATURE_PAYMENT_WEBHOOK_V2_SHADOW=false
FEATURE_CONTENT_STORE_V2=false
FAP_FEATURE_AGENT=false
FAP_FEATURE_INSIGHTS=false
FAP_FEATURE_ANALYTICS=true
FAP_PAYMENTS_ENABLED=true
FAP_PAYMENTS_WEBHOOKS_ENABLED=true
FAP_FORBID_MISSING_READS=false
FAP_FORBID_MISSING_OVERRIDES=false
FAP_EVENTS_MAX_TOP_KEYS=200
FAP_EVENTS_MAX_DEPTH=4
FAP_EVENTS_MAX_LIST_LENGTH=50
FAP_EVENTS_MAX_STRING_LENGTH=2048
FAP_EVENTS_MAX_PAYLOAD_BYTES=131072
PUBLIC_EVENT_MAX_PAYLOAD_BYTES=16384
PUBLIC_EVENT_META_MAX_BYTES=4096
PUBLIC_EVENT_META_MAX_KEYS=50

# 管理后台
FAP_ADMIN_TOKEN=
EVENT_INGEST_TOKEN=
FAP_ADMIN_PANEL_ENABLED=false
FAP_ADMIN_GUARD=admin
FAP_ADMIN_URL=http://localhost:18010/ops
OPS_ALLOWED_HOST=
OPS_IP_ALLOWLIST=
OPS_ADMIN_LOGIN_MAX_ATTEMPTS=5
OPS_ADMIN_LOGIN_DECAY_SECONDS=300
OPS_ADMIN_TOTP_ENABLED=true
OPS_ADMIN_TOTP_ISSUER="Fermat Ops"
OPS_ADMIN_PASSWORD_MIN_LENGTH=12
OPS_ADMIN_PASSWORD_REQUIRE_UPPERCASE=true
OPS_ADMIN_PASSWORD_REQUIRE_LOWERCASE=true
OPS_ADMIN_PASSWORD_REQUIRE_NUMBER=true
OPS_ADMIN_PASSWORD_REQUIRE_SYMBOL=true
OPS_ADMIN_PASSWORD_HISTORY_LIMIT=5
FAP_TENANT_PANEL_ENABLED=false
FAP_TENANT_GUARD=tenant
FAP_TENANT_URL=http://localhost:18010/tenant

# Ops go-live gate flags
OPS_GATE_PAYMENT_REFUND_DRILL_OK=false
OPS_GATE_DB_RESTORE_DRILL_OK=false
OPS_GATE_LOG_ROTATION_OK=false
OPS_GATE_SPF_DKIM_DMARC_OK=false
OPS_GATE_LEGAL_PAGES_OK=false
OPS_GATE_CONVERSION_TRACKING_OK=false
OPS_GATE_GSC_SITEMAP_OK=false

# Observability
SENTRY_DSN=
SENTRY_LARAVEL_DSN=
VITE_SENTRY_DSN=

# =========================
# Webhooks
# =========================
STRIPE_WEBHOOK_SECRET=
STRIPE_WEBHOOK_TOLERANCE_SECONDS=300
STRIPE_WEBHOOK_TOLERANCE=300
BILLING_WEBHOOK_SECRET=
BILLING_WEBHOOK_SECRET_OPTIONAL_ENVS=local,testing,ci
BILLING_WEBHOOK_TOLERANCE_SECONDS=300
BILLING_WEBHOOK_TOLERANCE=300
BILLING_WEBHOOK_ALLOW_LEGACY_SIGNATURE=false
PAYMENT_WEBHOOK_LOCK_TTL_SECONDS=10
PAYMENT_WEBHOOK_LOCK_BLOCK_SECONDS=5
PAYMENTS_WEBHOOK_MAX_BYTES=262144
INTEGRATIONS_WEBHOOK_MAX_BYTES=262144
PAYMENTS_ALLOW_STUB=false
PAYMENT_WEBHOOK_STRIPE_SUCCESS_EVENTS=payment_succeeded,payment_intent.succeeded,charge.succeeded,checkout.session.completed,invoice.payment_succeeded
PAYMENT_WEBHOOK_BILLING_SUCCESS_EVENTS=payment_succeeded,payment.success,payment_completed,paid
INTEGRATIONS_WEBHOOK_TOLERANCE_SECONDS=300
INTEGRATIONS_WEBHOOK_ALLOW_UNSIGNED=false
INTEGRATIONS_WEBHOOK_ALLOW_LEGACY_SIGNATURE=false
INTEGRATIONS_WEBHOOK_MOCK_SECRET=
INTEGRATIONS_WEBHOOK_MOCK_TOLERANCE_SECONDS=300
INTEGRATIONS_WEBHOOK_APPLE_HEALTH_SECRET=
INTEGRATIONS_WEBHOOK_GOOGLE_FIT_SECRET=
INTEGRATIONS_WEBHOOK_CALENDAR_SECRET=
INTEGRATIONS_WEBHOOK_SCREEN_TIME_SECRET=
