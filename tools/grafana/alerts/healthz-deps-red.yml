apiVersion: 1

groups:
  - orgId: 1
    name: healthz-deps
    folder: FAP
    interval: 5m
    rules:
      - uid: healthz-deps-red
        title: Healthz Deps Red Rate
        condition: C
        data:
          - refId: A
            datasourceUid: fap-mysql
            model:
              format: time_series
              rawSql: "SELECT day as time, dep_name, red_rate FROM v_healthz_deps_daily WHERE day >= CURDATE() - INTERVAL 7 DAY"
          - refId: B
            datasourceUid: __expr__
            model:
              type: reduce
              reducer: last
              expression: A
          - refId: C
            datasourceUid: __expr__
            model:
              type: threshold
              expression: B
              params:
                - 0.2
        for: 10m
        noDataState: NoData
        execErrState: Error
        annotations:
          summary: "Deps red rate above threshold"
        labels:
          severity: warning
