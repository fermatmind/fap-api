# 内容发布 / 回滚清单（content-release-checklist）

> 适用范围：FAP v0.2（MBTI 主流程）  
> 场景：MBTI 题库 / 评分规则 / 32 种人格结果文案 / 前端结果页排版等的更新与回滚。

---

## 0. 使用方式

- 本文件用于：**每一次内容相关的“上线 / 回滚”动作**。  
- 建议：每次发布新版本时，复制一份本清单到 Notion / 飞书 / GitHub Issue，按步骤逐条勾选。

---

## 1. 本次发布范围（Scope）

> 填写本次改动涉及的内容模块，避免“误伤”其他模块。

**1.1 类型（可多选）：**

- [ ] 题目文案更新（问题 / 选项）
- [ ] 评分规则调整（各维度权重、分数区间）
- [ ] MBTI 32 人格结果文案（说明书内容）
- [ ] 结果页排版 / UI 调整
- [ ] 埋点事件 / 字段调整
- [ ] 其他：`__________________`

**1.2 本次版本标记：**

- `scale_code`：`MBTI`（或其他）
- `scale_version`：`v0.2` / `v0.3` / …  
- `profile_version`：`mbti32-v2.5` / `mbti32-v2.6` / …

---

## 2. 上线前：内容准备检查（Pre-release Content Check）

### 2.1 文案结构与字段完整性

- [ ] 所有类型文案均符合 **mbti-content-schema** 定义的字段：
  - [ ] `id`
  - [ ] `typeCode`
  - [ ] `typeName`
  - [ ] `tagline`
  - [ ] `rarity`
  - [ ] `keywords[]`
  - [ ] `intro`
  - [ ] `traits`（`title` + `paragraphs[]`）
  - [ ] `career`（`title` + `paragraphs[]`）
  - [ ] `relationships`（`title` + `paragraphs[]`）
  - [ ] `growth`（`title` + `paragraphs[]`）
  - [ ] `meta`（至少包含 `profile_version` + `variant_id` + `tone`）

- [ ] 32 个类型 **全部覆盖**，没有缺失：
  - [ ] 16 主类型 × A/T：如 ENFJ-A / ENFJ-T / INTP-A / INTP-T …  
  - [ ] 文件命名与 `typeCode` 一致（如 `result_ENFJ-A.js` 对应 `typeCode = "ENFJ-A"`）

### 2.2 文案风格与语气

- [ ] 文案整体语气与目标人群匹配（中国大学生 / 社会青年）
- [ ] 无低俗、歧视、标签化攻击等内容
- [ ] 不出现绝对化、诊断类用语（如“你就是XX障碍”“你一定会抑郁”等）
- [ ] 提示内容为「倾向」与「参考建议」，而非医学诊断

### 2.3 合规与敏感内容

- [ ] 已对照《compliance-basics.md》 & 《copywriting-no-go-list.md》自检
- [ ] 无以下高风险表达：
  - [ ] 医疗诊断承诺（如“治愈”“疗效”）
  - [ ] 极端行为鼓励（自残 / 他杀 / 报复等）
  - [ ] 仇恨 / 歧视言论（性别 / 政治 / 种族 / 地区等）
- [ ] 如涉及情绪低落 / 抑郁倾向提示，已加上：
  - [ ] “仅为风险提示，不构成诊断”
  - [ ] “如长期痛苦，建议及时寻求专业帮助”等安全文案。

### 2.4 技术格式与编码

- [ ] 所有 JSON / JSONL 文件通过 JSON 校验（无多余逗号 / 引号错误）
- [ ] JS 导出文件能被 Node / Laravel 正常 `require` / `import`
- [ ] 字符编码为 UTF-8（无乱码）

---

## 3. 上线前：数据与环境检查（Pre-release Env Check）

### 3.1 环境确认

- [ ] 当前修改确认在 **本地 / 测试环境** 完成，非直接在 production 服务器上改动。
- [ ] `.env` / `.env.production` 中以下配置已确认：
  - [ ] `APP_ENV` 正确（local / production）
  - [ ] `DB_` 相关指向正确数据库（避免把测试数据写入线上库）
  - [ ] 日志路径无异常（方便回溯）

### 3.2 基线数据记录（建议）

在发布前，记录一份最近 7 天的关键指标（可使用 `fap:weekly-report` 或手工 SQL）：

- [ ] 最近 7 天：
  - [ ] `scale_view` 数量：`______`
  - [ ] `test_start` 数量：`______`
  - [ ] `test_submit` 数量：`______`
  - [ ] `result_view` 数量：`______`
  - [ ] `share_generate` 数量：`______`
- [ ] 各 `type_code` 的占比快照（可导出为 Excel / 图片）
- [ ] 当前线上 `profile_version` 记录：`________`

---

## 4. 发布步骤（Release Steps）

### 4.1 代码 / 内容变更准备

- [ ] 所有内容变更已提交到 Git 对应分支：
  - [ ] 更新的内容文件（如 `data/mbti32/...`）
  - [ ] 对应的加载逻辑 / 配置（如后端从 `mbti32-v2.5` 切到 `mbti32-v2.6`）
  - [ ] 如有前端修改，已打包构建通过

- [ ] Git 提交信息清晰，例如：
  - `feat: update MBTI profiles to mbti32-v2.6`
  - `fix: adjust ENFJ-A growth suggestions`

### 4.2 部署到测试 / 预发布环境（如有）

- [ ] 部署到测试环境（staging）完成
- [ ] 使用真实或接近真实的 payload 测试：
  - [ ] `POST /api/v0.2/attempts`
  - [ ] `GET /api/v0.2/attempts/{id}/result`
- [ ] 确认：
  - [ ] 返回的 `profile` 字段结构正常
  - [ ] `type_code` 与预期一致
  - [ ] 字段无缺失 / 拼写错误

### 4.3 正式环境发布窗口

- [ ] 选择低峰期发布（非大量推广 / 高频使用时间）
- [ ] 事先通知相关同事（如未来有团队）：运营 / 客服 / 技术
- [ ] 预留观察时间（如 30–60 分钟）

---

## 5. 正式上线后的验证（Post-release Smoke Test）

上线后立即进行以下检查：

### 5.1 接口功能验证

- [ ] 通过 Postman / curl / 小程序实际跑一次：
  - [ ] `POST /api/v0.2/attempts` 返回 201，无报错
  - [ ] `GET /api/v0.2/attempts/{id}/result` 返回 200，无报错
- [ ] 返回 JSON 中：
  - [ ] `type_code` 合理（无空值 / 无非法类型）
  - [ ] `scores` 字段结构正常
  - [ ] `profile` 中的文案字段符合新版本内容（可以对比某个独特句子）

### 5.2 日志与事件检查

- [ ] 检查 `laravel.log` 中是否存在异常（ERROR / WARNING）：
  - [ ] JSON 解码报错
  - [ ] 文件找不到（file not found）
  - [ ] 字段缺失（undefined index / property）
- [ ] `events` 表中是否正常写入：
  - [ ] `test_submit` / `result_view` 等事件仍在增长
  - [ ] 无明显断崖式下降

### 5.3 视觉与体验检查

- [ ] 小程序 / Web 端结果页展示正常：
  - [ ] 各模块顺序正确（intro → traits → career → relationships → growth）
  - [ ] 文案没有截断 / 溢出严重
  - [ ] 格式化符号（引号 / 破折号 / 换行）显示正常

---

## 6. 回滚预案（Rollback Plan）

> 一旦发现严重问题（如结果类型错误、文案导向有重大风险），立即按下列步骤回滚。

### 6.1 可回滚条件提前准备

- [ ] 在 Git 中使用 **tag/branch** 标记上一版稳定版本：
  - [ ] 如：`v0.2-mbti32-v2.5-stable`
- [ ] 旧版本的内容文件保留完整（不要覆盖删除）
- [ ] 如引入了新 `profile_version`，确保在代码中可以切回旧版本：
  - [ ] 比如通过 `.env` 或配置文件控制 `PROFILE_VERSION_ACTIVE`

### 6.2 回滚操作步骤

一旦确认需要回滚：

- [ ] 立即暂停大规模推广（如关闭广告 / 暂停引流）
- [ ] Git 回滚到上一个稳定版本：
  - [ ] `git checkout <stable-tag>` 或 `git revert <commit>`
- [ ] 重新部署后端 / 前端到正式环境
- [ ] 再次执行 **第 5 章** 的所有校验（接口 / 日志 / 结果页）

### 6.3 回滚后复盘记录（建议）

- [ ] 记录本次事故原因：
  - [ ] 文案问题 / 技术问题 / 配置错误 / 测试不充分等
- [ ] 标注到本文件或单独复盘文档中：
  - [ ] “下次发布必须增加哪一步自检”

---

## 7. 一次发布记录模板（示例）

> 每次发版建议简单记录一条，以便日后回溯。

- 发布日期：`2025-12-__`
- 发布人：`__________`
- 涉及模块：
  - [ ] MBTI 32 类型结果文案
  - [ ] 结果页排版
  - [ ] 埋点
  - [ ] 其他：`__________`
- 新版本信息：
  - `scale_version`：`v0.2`
  - `profile_version`：`mbti32-v2.6`
- 测试环境验证情况：
  - [ ] 已通过（描述主要验证点）
- 上线后 1 小时观察结果：
  - 指标变化：`scale_view`: ___，`test_submit`: ___，`result_view`: ___
  - 异常日志：`无 / 有（已记录在 log 链接：____）`
- 是否触发回滚：
  - [ ] 否
  - [ ] 是（原因：`__________`，回滚时间：`__________`）

---

> 提示：  
> 随着后续量表类型（IQ / 抑郁筛查 / 关系测评等）增加，本清单可以按“公共部分 + 各量表子清单”的方式拆分；公共部分继续使用本文件，子清单只补充各自特有的检查项。